// Google Apps Script backend for v8 (same schema as v7)
const SHEET_NAME='PhysicianEligibility'; const EMAIL_NOTIFY=''; const HEADERS=["timestamp_iso","profession","candidate_full_name","email","mobile","nationality_status","qid_status","qualification_country_category","qualification_country_name","bachelor_program_years","internship_completed","observership_only","target_scope","specialty_name","specialty_certificate_category","specialty_certificate_title","specialty_awarding_body","specialty_award_country","specialty_award_year","post_specialization_years_total","prior_clinical_years_before_break","break_in_practice_years","experience_sources","experience_documents_uploaded","notes_for_followup","eligibility_headline","additional_requirements","missing_requirements","eligibility_text"]; function _getSheet(){const ss=SpreadsheetApp.getActiveSpreadsheet();let sh=ss.getSheetByName(SHEET_NAME);if(!sh){sh=ss.insertSheet(SHEET_NAME);}const first=sh.getRange(1,1,1,HEADERS.length).getValues()[0];const needHeaders=first.filter(String).length===0;if(needHeaders){sh.getRange(1,1,1,HEADERS.length).setValues([HEADERS]);}return sh;} function doPost(e){try{const sh=_getSheet(); const data=JSON.parse(e.postData.contents); const row=HEADERS.map(h=> (h in data? (Array.isArray(data[h])? JSON.stringify(data[h]) : data[h]) : '')); sh.appendRow(row); if(EMAIL_NOTIFY){ MailApp.sendEmail({to:EMAIL_NOTIFY, subject:'New Eligibility Submission: '+(data.candidate_full_name||''), htmlBody:'<pre>'+JSON.stringify(data,null,2)+'</pre>'}); } return ContentService.createTextOutput(JSON.stringify({ok:true})).setMimeType(ContentService.MimeType.JSON);}catch(err){ return ContentService.createTextOutput(JSON.stringify({ok:false,error:String(err)})).setMimeType(ContentService.MimeType.JSON);} } function doGet(){ return ContentService.createTextOutput('OK'); }
